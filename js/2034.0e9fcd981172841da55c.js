"use strict";(self.webpackChunkinsights_inventory_frontend=self.webpackChunkinsights_inventory_frontend||[]).push([[2034],{32034:(e,t,n)=>{n.r(t),n.d(t,{calculatePagination:()=>N,default:()=>R});var r=n(87462),i=n(4942),o=n(93324),a=n(92950),l=n.n(a),s=n(45697),u=n.n(s),c=n(50533),d=n(75662),f=n(48716),p=n(39173),v=n(86350),g=n(30319),h=n(81730),m=n(94778),y=n(50693),b=n(16475),O=n(35435),S=n(39903),F=n(95045),E=n(94654),_=n.n(E),w=n(13784),P=n(89845);function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(Object(n),!0).forEach((function(t){(0,i.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var C=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;return e.every((function(e){var n=e.id;return t&&t.has(n)}))?e.length>0:e.some((function(e){var n=e.id;return t&&t.has(n)}))&&null},Z=function(e){var t=e.category;return e.values.map((function(e){var n=e.tagKey,r=e.value;return"".concat(t?"".concat(t,"/"):"").concat(n).concat(r?"=".concat(r):"")}))},A={staleFilter:function(e,t){return e.staleFilter.forEach((function(e){return t.append("status",e)}))},osFilter:function(e,t){var n=e.osFilter;return null==n?void 0:n.forEach((function(e){return t.append("operating_system",e)}))},registeredWithFilter:function(e,t){var n=e.registeredWithFilter;return null==n?void 0:n.forEach((function(e){return t.append("source",e)}))},value:function(e,t){var n=e.value,r=e.filter;return"hostname_or_id"===n&&Boolean(r)&&t.append("hostname_or_id",r)},tagFilters:function(e,t){var n=e.tagFilters;return(null==n?void 0:n.length)>0&&t.append("tags",_()(n,Z))}},N=function(e,t,n){var r=new URLSearchParams(location.search),i=void 0!==t?t:r.get("page"),o=void 0!==n?n:r.get("per_page");!isNaN(parseInt(i))&&e.append("page",i),!isNaN(parseInt(o))&&e.append("per_page",o)},T=function(e){var t=e.status,n=e.source,s=e.filterbyName,u=e.tagsFilter,E=e.operatingSystem,_=e.page,k=e.perPage,Z=e.initialLoading,T=(0,a.useState)(),R=(0,o.Z)(T,2),D=R[0],L=R[1];document.title="Inventory | Red Hat Insights";var I=(0,d.useHistory)(),M=(0,c.useStore)(),W=(0,a.useContext)(g.gE).getRegistry,x=(0,a.useRef)(null),G=(0,a.useState)(!1),U=(0,o.Z)(G,2),q=U[0],B=U[1],H=(0,a.useState)({}),K=(0,o.Z)(H,2),z=K[0],J=K[1],V=(0,a.useState)([]),Y=(0,o.Z)(V,2),$=Y[0],Q=Y[1],X=(0,a.useState)(!1),ee=(0,o.Z)(X,2),te=ee[0],ne=ee[1],re=(0,a.useState)(),ie=(0,o.Z)(re,2),oe=ie[0],ae=ie[1],le=(0,c.useSelector)((function(e){var t=e.permissionsReducer;return{loading:null==t?void 0:t.loading,writePermissions:null==t?void 0:t.writePermissions}}),c.shallowEqual),se=le.loading,ue=le.writePermissions,ce=(0,c.useSelector)((function(e){var t=e.entities;return null==t?void 0:t.rows}),c.shallowEqual),de=(0,c.useSelector)((function(e){var t=e.entities;return null==t?void 0:t.loaded})),fe=(0,c.useSelector)((function(e){var t=e.entities;return null==t?void 0:t.selected})),pe=(0,c.useDispatch)(),ve=function(e,t){return pe(m.CL(e,t))},ge=function(e,t){null!=e&&e.filters||(e.filters=Object.entries(w.js).map((function(e){var t=(0,o.Z)(e,2),n=t[0],r=t[1];return(0,i.Z)({},n,r)})));var n=((null==e?void 0:e.filters)||[]).reduce((function(e,t){return j(j(j(j(j(j({},e),(null==t?void 0:t.staleFilter)&&{status:t.staleFilter}),(null==t?void 0:t.registeredWithFilter)&&{source:t.registeredWithFilter}),(null==t?void 0:t.tagFilters)&&{tagsFilter:t.tagFilters}),"hostname_or_id"===(null==t?void 0:t.value)&&{filterbyName:t.filter}),(null==t?void 0:t.osFilter)&&{operatingSystem:t.osFilter})}),{status:void 0,source:void 0,tagsFilter:void 0,filterbyName:void 0,operatingSystem:void 0}),r=n.status,a=n.source,l=n.tagsFilter,s=n.filterbyName,u=n.operatingSystem;e.filters=(0,w.h3)(r,a,l,s,u),Q(null==e?void 0:e.filters);var c=new URLSearchParams;!function(e){(arguments.length>1&&void 0!==arguments[1]?arguments[1]:[]).forEach((function(t){Object.keys(t).forEach((function(n){var r;null==A||null===(r=A[n])||void 0===r||r.call(A,t,e)}))}))}(c,null==e?void 0:e.filters),N(c,null==e?void 0:e.page,null==e?void 0:e.per_page);var d=c.toString();I.push({search:d,hash:location.hash}),!t&&null!=x&&x.current?x.current.onRefreshData(e):t&&t(e)};(0,a.useEffect)((function(){var e,r;null===(e=insights.chrome)||void 0===e||null===(r=e.hideGlobalFilter)||void 0===r||r.call(e,!1),insights.chrome.appAction("system-list"),insights.chrome.appObjectId(),insights.chrome.on("GLOBAL_FILTER_UPDATE",(function(e){var t,n,r,i,a=e.data,l=null===(t=insights.chrome)||void 0===t||null===(n=t.mapGlobalFilter)||void 0===n?void 0:n.call(t,a,!1,!0),s=(0,o.Z)(l,3),u=s[0],c=s[1],d=s[2];ae({tags:d,filter:j(j({},null==oe?void 0:oe.filter),{},{system_profile:j(j(j({},null==oe||null===(r=oe.filter)||void 0===r?void 0:r.system_profile),(null==u||null===(i=u.SAP)||void 0===i?void 0:i.isSelected)&&{sap_system:!0}),(null==c?void 0:c.length)>0&&{sap_sids:c})})})})),pe(m.L1());var i=(0,P.inventoryConnector)(M,void 0,void 0,!0).InventoryTable;L((function(){return i})),W().register(j({},(0,h.AF)(g.M)));var a=(0,w.h3)(t,n,u,s,E);(null==a?void 0:a.length)>0&&pe(m.Tv(a)),(k||_)&&pe(m.Jr(Array.isArray(_)?_[0]:_,Array.isArray(k)?k[0]:k))}),[]);var he=function(){return fe?fe.size:0};return l().createElement(l().Fragment,null,l().createElement(f.Z,{className:"pf-m-light"},l().createElement(p.Z,{title:"Inventory"})),l().createElement(v.Z,null,l().createElement(y.r,{gutter:"md"},l().createElement(b.P,{span:12},!se&&D&&l().createElement(D,(0,r.Z)({history:I,store:M,customFilters:oe,isFullView:!0,ref:x,showTags:!0,onRefresh:ge,hasCheckbox:ue,autoRefresh:!0,initialLoading:Z},ue&&{actions:[{title:"Delete",onClick:function(e,t,n){var r=n.id,i=n.display_name;J((function(){return{id:r,displayName:i}})),B((function(){return!0}))}},{title:"Edit",onClick:function(e,t,n){J((function(){return n})),ne((function(){return!0}))}}],actionsConfig:{actions:[{label:"Delete",props:{isDisabled:0===he(),variant:"secondary",onClick:function(){J(Array.from(fe.values())),B(!0)}}}]},bulkSelect:{count:he(),id:"bulk-select-systems",items:[{title:"Select none (0)",onClick:function(){ve(-1,!1)}},j({},de&&ce&&ce.length>0?{title:"Select page (".concat(ce.length,")"),onClick:function(){ve(0,!0)}}:{})],checked:C(ce,fe),onSelect:function(e){ve(0,e)}}},{tableProps:{canSelectAll:!1},onRowClick:function(e,t,n){return I.push("/".concat(t).concat(n?"/".concat(n):""))}}))))),l().createElement(S.Z,{handleModalToggle:B,isModalOpen:q,currentSytems:z,onConfirm:function(){var e,t,n,r;Array.isArray(z)?(t=z.map((function(e){return e.id})),e=z.length>1?"".concat(z.length," systems"):z[0].display_name):(e=z.displayName,t=[z.id]),pe((0,O.wN)({id:"remove-initiated",variant:"warning",title:"Delete operation initiated",description:"Removal of ".concat(e," started."),dismissable:!1})),pe((r=function(){return ge({filters:$})},(n=m.Ks(t,e)).payload.then(r),n)),B(!1)}}),l().createElement(F.TextInputModal,{title:"Edit display name",isOpen:te,value:z.display_name,onCancel:function(){return ne(!1)},onSubmit:function(e){pe(m.$Y(z.id,e)),ne(!1)}}))};T.propTypes={status:u().oneOfType([u().arrayOf(u().string),u().string]),source:u().oneOfType([u().arrayOf(u().string),u().string]),operatingSystem:u().oneOfType([u().arrayOf(u().string),u().string]),filterbyName:u().string,tagsFilter:u().any,page:u().oneOfType([u().string,u().number]),perPage:u().oneOfType([u().string,u().number]),initialLoading:u().bool},T.defaultProps={initialLoading:!0};const R=T}}]);